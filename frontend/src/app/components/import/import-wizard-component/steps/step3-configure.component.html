@if (preview(); as previewData) {
  <mat-card appearance="outlined" class="configure-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>tune</mat-icon>
      <mat-card-title>Parsing Configuration</mat-card-title>
      <mat-card-subtitle
        >Configure date format, separators, and other import settings</mat-card-subtitle
      >
    </mat-card-header>

    <mat-card-content>
      <!-- Date Format -->
      <div class="config-section">
        <h3 class="section-title">
          <mat-icon>calendar_today</mat-icon>
          Date Format
        </h3>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Date Format</mat-label>
          <mat-select [value]="dateFormat()" (selectionChange)="updateDateFormat($event.value)">
            @for (preset of dateFormatPresets; track preset.value) {
              <mat-option [value]="preset.value">{{ preset.label }}</mat-option>
            }
          </mat-select>
          <mat-hint>Select the date format used in your file</mat-hint>
        </mat-form-field>

        @if (dateFormat() === 'custom') {
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Custom Date Format</mat-label>
            <input
              matInput
              [value]="dateFormat()"
              (input)="updateDateFormat($any($event.target).value)"
              placeholder="e.g., dd/MM/yyyy"
            />
            <mat-hint>Use: dd (day), MM (month), yyyy (year)</mat-hint>
          </mat-form-field>
        }
      </div>

      <mat-divider></mat-divider>

      <!-- Decimal Separator -->
      <div class="config-section">
        <h3 class="section-title">
          <mat-icon>decimal_increase</mat-icon>
          Decimal Separator
        </h3>
        <mat-radio-group
          [value]="decimalSeparator()"
          (change)="updateDecimalSeparator($event.value)"
          class="radio-group"
        >
          <mat-radio-button value=".">Period (.) - US format (1,234.56)</mat-radio-button>
          <mat-radio-button value=",">Comma (,) - European format (1.234,56)</mat-radio-button>
        </mat-radio-group>
      </div>

      <mat-divider></mat-divider>

      <!-- Thousands Separator -->
      <div class="config-section">
        <h3 class="section-title">
          <mat-icon>format_list_numbered</mat-icon>
          Thousands Separator
        </h3>
        <mat-radio-group
          [value]="thousandsSeparator()"
          (change)="updateThousandsSeparator($event.value)"
          class="radio-group"
        >
          <mat-radio-button value=",">Comma (,) - US format (1,234.56)</mat-radio-button>
          <mat-radio-button value=".">Period (.) - European format (1.234,56)</mat-radio-button>
          <mat-radio-button value=" ">Space ( ) - Alternative format (1 234,56)</mat-radio-button>
        </mat-radio-group>
      </div>

      <mat-divider></mat-divider>

      <!-- Rows to Skip -->
      <div class="config-section">
        <h3 class="section-title">
          <mat-icon>skip_next</mat-icon>
          Rows to Skip
        </h3>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Number of rows to skip</mat-label>
          <input
            matInput
            type="number"
            min="0"
            [value]="rowsToSkip()"
            (input)="updateRowsToSkip(+$any($event.target).value)"
          />
          <mat-hint>Skip header or empty rows at the beginning of the file</mat-hint>
        </mat-form-field>
      </div>

      <mat-divider></mat-divider>

      <!-- Save as Template -->
      <div class="config-section">
        <h3 class="section-title">
          <mat-icon>save</mat-icon>
          Save as Template
        </h3>
        <div class="template-options">
          <mat-checkbox
            [checked]="saveAsTemplate()"
            (change)="updateSaveAsTemplate($event.checked)"
          >
            Save these settings as a template for future imports
          </mat-checkbox>

          @if (saveAsTemplate()) {
            <mat-form-field appearance="outline" class="full-width template-name-field">
              <mat-label>Template Name</mat-label>
              <input
                matInput
                [value]="templateName()"
                (input)="updateTemplateName($any($event.target).value)"
                placeholder="e.g., Intesa Sanpaolo Statement"
              />
              <mat-hint>Give this template a descriptive name</mat-hint>
            </mat-form-field>
          }
        </div>
      </div>
    </mat-card-content>
  </mat-card>
} @else {
  <div class="no-preview">
    <mat-icon>cloud_upload</mat-icon>
    <p>No file uploaded yet. Please upload and configure a file in the previous steps.</p>
  </div>
}
