<mat-card class="settings-card">
  <mat-card-header>
    <mat-card-title>Account settings</mat-card-title>
    <mat-card-subtitle>Update your email address and current balance.</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    @if (error()) {
      <p class="error-message" role="alert">{{ error() }}</p>
    }

    @if (loading()) {
      <div class="loading-state" aria-live="polite">
        <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
        <span>Saving your changesâ€¦</span>
      </div>
    }

    @if (!loading()) {
      @if (account(); as activeAccount) {
        <form
          [formGroup]="accountForm"
          (ngSubmit)="onSubmit()"
          class="account-form"
          aria-describedby="settings-helper"
          novalidate
        >
          <p id="settings-helper" class="helper-text">
            Keep your contact information and running balance up to date.
          </p>

          @let emailControl = accountForm.controls.email;
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              required
              autocomplete="email"
              [value]="account()?.email"
            />
            @if (
              emailControl.hasError('required') && (emailControl.dirty || emailControl.touched)
            ) {
              <mat-error>Email is required.</mat-error>
            }
            @if (emailControl.hasError('email') && (emailControl.dirty || emailControl.touched)) {
              <mat-error>Enter a valid email address.</mat-error>
            }
          </mat-form-field>

          @let balanceControl = accountForm.controls.currentBalance;
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Current balance</mat-label>
            <input
              matInput
              type="number"
              step="0.01"
              formControlName="currentBalance"
              required
              autocomplete="off"
            />
            <mat-hint align="end">Enter the amount available in your account.</mat-hint>
            @if (
              balanceControl.hasError('required') &&
              (balanceControl.dirty || balanceControl.touched)
            ) {
              <mat-error>Balance is required.</mat-error>
            }
          </mat-form-field>

          <div class="form-actions">
            <button mat-flat-button color="primary" type="submit" [disabled]="loading()">
              Save changes
            </button>
          </div>
        </form>

        <mat-divider></mat-divider>

        <button
          mat-flat-button
          color="warn"
          (click)="onDeleteAllImportedData()"
          class="danger-button"
        >
          <mat-icon>warning</mat-icon>
          Delete all imported data
        </button>
      } @else {
        <p class="empty-state" role="status">We could not load your account information.</p>
      }
    }
  </mat-card-content>
</mat-card>
